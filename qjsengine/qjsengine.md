---
date: 2016-03-23
categories:
  - it
  - programming
tags:
  - Qt
  - –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä
  - C++
  - QJSEngine
latex: true
author: Anton Sergienko
author-email: anton.b.sergienko@gmail.com
license: CC BY 4.0
license-url: https://github.com/Harrix/harrix.dev/blob/main/LICENSE.md
permalink-source: https://github.com/Harrix/harrix.dev-articles-2016/blob/main/qjsengine/qjsengine.md
permalink: https://harrix.dev/ru/articles/2016/qjsengine/
lang: ru
---

# –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π –≤ Qt ‚Äî QJSEngine

![Featured image](featured-image.svg)

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –≤ Qt (QtScript) —É—Å—Ç–∞—Ä–µ–ª. –¢–µ–ø–µ—Ä—å –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ QJSEngine. –í —Å—Ç–∞—Ç—å–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –∫–∞–∫ —Å –Ω–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–π.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ü—Ä–æ—Ü–µ—Å—Å](#–ø—Ä–æ—Ü–µ—Å—Å)
- [–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è](#–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ-–ø—Ä–æ—Å—Ç–æ–≥–æ-–≤—ã—Ä–∞–∂–µ–Ω–∏—è)

–°—Ç–∞—Ç—å—è –ø–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å–æ —Å—Ç–∞—Ç—å–µ–π [–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ –≤ Qt ‚Äî QtScript](https://github.com/Harrix/harrix.dev-articles-2014/blob/main/qtscript/qtscript.md) | [ü°•](https://harrix.dev/ru/articles/2014/qtscript/), –≥–¥–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ QtScript.

–ú—ã –±—É–¥–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–¥–Ω–æ–π –∏ –¥–≤—É–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏. –ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –Ω–∏–º–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –ø–æ–¥ —Å–µ–±—è.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏:** –£ –Ω–∞—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∏–ø–∞ QString –∑–∞–ø–∏—Å–∞–Ω –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏: $y(x)=sin(x)+1$. –ù–∞–¥–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —ç—Ç–æ–π —Ç–æ—á–∫–µ.

–î–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Qt –Ω–∞ Qt Widgets.

## –ü—Ä–æ—Ü–µ—Å—Å

–í–Ω–∞—á–∞–ª–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ —Ñ–∞–π–ª–µ –ø—Ä–æ–µ–∫—Ç–∞ `.pro` —Ñ–∞–∫—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è QML —á–µ—Ä–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ–≤–∞ `qml`. –ë–µ–∑ —ç—Ç–æ–≥–æ –Ω–µ –±—É–¥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã:

```cpp
QT += core gui qml
```

![–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è ¬´qml¬ª](img/qjsengine_01.png)

_–†–∏—Å—É–Ω–æ–∫ 1 ‚Äî –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è ¬´qml¬ª_

–í —Ñ–∞–π–ª–µ `mainwindow.cpp` –∏–ª–∏ –≤ —Ç–æ–º, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ–ø–∏—à–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

```cpp
#include <QJSEngine>
```

![–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ QJSEngine](img/qjsengine_02.png)

_–†–∏—Å—É–Ω–æ–∫ 2 ‚Äî –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ QJSEngine_

–ê –≤ –∫–Ω–æ–ø–∫–µ –ø—Ä–æ–ø–∏—à–∏—Ç–µ —Ç–∞–∫–æ–π –∫–æ–¥:

```cpp
 //–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
double x=2;//–≤ –∫–∞–∫–æ–π —Ç–æ—á–∫–∏ –∏—â–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
QString CodeFunction="r = Math.sin(x);r = r + 1;";

//–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
double result;
QJSEngine myEngine;
QJSValueList args;

//–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–≤–∏–∂–∫–∞
QJSValue fun = myEngine.evaluate("(function fun(x) { var r=0;"+CodeFunction+" return r;})");

//–ó–∞–∫–∏–¥—ã–≤–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏
args << x;

//–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ç–æ—á–∫–µ
QJSValue value = fun.call(args);

result = value.toNumber();

ui->textEdit->insertPlainText(QString::number(result)+"\n");
```

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –ø–æ–ª—É—á–∏—Ç–µ –≤–æ—Ç —ç—Ç–æ:

![–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã](img/qjsengine_03.png)

_–†–∏—Å—É–Ω–æ–∫ 3 ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã_

–î–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ —Å –¥–≤—É–º—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, $z(x,y)=x+y$) –∫–æ–¥ –±—É–¥–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è:

```cpp
 //–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
double x=2, y=3;//–≤ –∫–∞–∫–æ–π —Ç–æ—á–∫–∏ –∏—â–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
QString CodeFunction="r = x + y;";

//–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
double result;
QJSEngine myEngine;
QJSValueList args;

//–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–≤–∏–∂–∫–∞
QJSValue fun = myEngine.evaluate("(function fun(x,y) { var r=0;"+CodeFunction+" return r;})");

//–ó–∞–∫–∏–¥—ã–≤–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏
args << x << y;

//–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ç–æ—á–∫–µ
QJSValue value = fun.call(args);

result = value.toNumber();

ui->textEdit->insertPlainText(QString::number(result)+"\n");
```

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–æ–ª—É—á–∏–º –≤–æ—Ç —ç—Ç–æ:

![–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã](img/qjsengine_04.png)

_–†–∏—Å—É–Ω–æ–∫ 4 ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã_

## –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è

–ï—Å–ª–∏ –∂–µ –≤–∞–º –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –≤—Å—è–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —Ç–æ –≤—Å—ë –≥–æ—Ä–∞–∑–¥–æ –ø—Ä–æ—â–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–∏–º–µ—Ä $2+2\cdot2$. –¢–æ–≥–¥–∞ –∫–æ–¥ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```cpp
QString CodeFunction="2+2*2";

QJSEngine myEngine;

QJSValue value = myEngine.evaluate(CodeFunction);

double result = value.toNumber();

ui->textEdit->insertPlainText(QString::number(result)+"\n");
```

–í–æ—Ç –∏ –≤—Å—ë –ø–æ–∫–∞) –≤—ã –º–æ–∂–µ—Ç–µ —Å–ø–æ–∫–æ–π–Ω–æ –≤–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ —è–∑—ã–∫–µ JavaScript —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã, –ø–æ–ª—è –≤–≤–æ–¥–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Å–≤–æ–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö. –ö–æ–Ω–µ—á–Ω–æ, —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Ç–∞–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –±—É–¥–µ—Ç –ø–æ–º–µ–Ω—å—à–µ, —á–µ–º —É –æ–±—ã—á–Ω—ã—Ö C++ —Ñ—É–Ω–∫—Ü–∏–π, –Ω–æ —ç—Ç–æ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ.

–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∫–ª–∞—Å—Å—É –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –≤ <https://doc.qt.io/qt-5/qjsengine.html>.
